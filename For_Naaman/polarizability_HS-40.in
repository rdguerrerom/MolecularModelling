memory 8gb
molecule {
    symmetry c1 # this is important; some perturbations will break symmetry
#    no_reorient
N         0.21975826253394   -2.36849311256202   -0.05872192174198
C         0.25986975126628   -2.31128988678733    1.27085518883607
C         0.26132146788333   -1.23369991044727   -0.72812632535367
C         0.29888726677050   -0.02363824216314   -2.64889025850876
C         0.41602167303421    2.22451586168217    1.29224825468591
N         0.32887338591139   -0.03683865482945   -0.02867405315031
N         0.24184220959613   -1.20929150296058   -2.04540093689716
N         0.42463524955434    2.29577170984938   -0.03741317421364
N         0.32578637944896   -1.19720816781713    1.99705590613213
C         0.22930765806254   -3.57722701055748    1.99378150129458
N         0.38860315246573    1.10209653658636    2.00785056496261
C         0.34947987977020   -0.04450737570842    1.35900601485317
C         0.43384676471069    3.48296392018401    2.02864290295906
C         0.37695084380854    1.16756522697145   -0.71678800600552
N         0.36787038454394    1.15580659763157   -2.03492132828083
C         0.27858249477109   -0.01707062218986   -4.10690394041599
H        -0.03138199901787   -4.73832536184695    0.22309774093420
C         0.34410133807999   -3.59530950802502    3.38478523788148
C         0.18610067770650   -5.99851529916339    3.36341321265766
C         0.07344916134892   -4.77568491851723    1.29587282037287
C         0.14592394472073   -7.26160245315676    4.16549538775395
H        -0.10570590396225   -6.89151827187884    1.42394370378847
C         0.04955788024433   -5.97563228892510    1.97656953529931
C         0.31815188935418   -4.79762943352023    4.05849750072178
H         0.44943806646519   -2.65862701294953    3.90846340257161
H         0.39550407442224   -4.83556930712152    5.13460303430414
C         0.18473614863383   -1.21748996435423   -4.81316159730333
C         0.15847007532183   -1.20151318893224   -6.19139845203004
H         0.41910783699989    2.14027207841630   -6.70607401409455
C         0.36056139857824    1.19088762389403   -4.80129306551531
H         0.13635202468566   -2.14178926482136   -4.25990640113583
H         0.45147233224914    2.10546918991841   -4.23692836300960
C         0.32655229636140    1.20019186270577   -6.18066722345694
C         0.21136256147711    0.00460622819430   -6.88743456541370
C         0.18442036208339   -0.05339592078742   -8.38288018624915
H         0.09708800082341   -2.11826923996409   -6.75816842690577
C         0.43646258118440    7.20282546435415    4.14085300528070
H         0.56048962234617    6.83318103337029    1.54311313862972
C         0.51436685018067    5.88174455692272    2.05112036552705
H         0.26087248601260    4.64362138754572    5.19851200875296
H         0.56088365712641    4.68412362857964    0.26813689141505
C         0.45252049258646    5.87842083888349    3.44350614072632
C         0.35121992324247    3.47604390348455    3.42190649925801
C         0.35922517480101    4.66476988214958    4.12231845824787
H         0.27542421692042    2.52750239014650    3.92961255953774
C         0.51051555831488    4.69762004064815    1.34518183908970
O        -0.29336386269176   -7.28953806596570    5.29840960046368
N         0.66445272272351   -8.34837920201494    3.54899907748410
H         1.62297318608953  -10.11960963126699    4.07106552992857
N        -0.45398705002703    0.97955047880913   -8.97854577759988
O         0.67549237064124   -0.97658007039939   -9.00184571469139
H        -0.85712557173345    1.70976318670084   -8.41426758907959
C        -0.54884596215712    1.11542310016591  -10.41306241538956
H        -1.60254504417425    1.19358440561372  -10.70275965429182
C         0.22407311540476    2.33250516150433  -10.92245883036181
H        -0.13216242987291    0.19946882819012  -10.83787062620306
H        -0.18402503741849    3.23949833014107  -10.46801712472379
H         1.26805106979344    2.24321477309969  -10.61541868317003
C         0.14483114878008    2.44403334241226  -12.44244775037212
H        -0.90243838991468    2.51805968178668  -12.74518307772602
C         0.90908038999128    3.65595476931500  -12.97009184567632
H         0.55455344436936    1.53622431142520  -12.88973825571825
H         0.49705829083178    4.56594616934553  -12.52713809614010
H         1.95518674824898    3.58432076426714  -12.66404445523242
C         0.83445744137070    3.75721736813382  -14.49166630535289
H        -0.21243192637964    3.82233867689704  -14.79794924943721
C         1.59171536294823    4.97009756122124  -15.02646128713999
H         1.25050456847311    2.84883019747988  -14.93350436207910
H         1.17421251530455    5.87945609818174  -14.58730857945951
H         2.63846620774018    4.90653746236219  -14.71979950858881
C         1.51835184384678    5.06701633386111  -16.54843798278760
H         0.47140902961433    5.12301474907774  -16.85557043041234
C         2.26642894074141    6.28454837705709  -17.07716318266118
H         1.94294603251939    4.16133460185364  -16.98753594979521
H         1.84350496990989    7.19952282233180  -16.66778145085386
H         3.31649434837659    6.23856997505374  -16.79657267739070
H         2.20287153495377    6.33250901720982  -18.16180007345119
O        -0.05178960325520    8.19219530525591    3.63108850583622
N         1.02910242843904    7.21521805035976    5.35659761879580
H         1.42787637233810    6.36800683604362    5.72701972202204
C         1.05439255365514    8.38817424858156    6.19859825573623
H         0.67360455639768    9.21241493540970    5.59140449869678
C         0.18901741414855    8.21150142391032    7.44726769181608
H         2.08828121665120    8.60674781402217    6.48671164748008
H        -0.83287970577619    7.98145398373136    7.13903717211316
H         0.56207650251798    7.36683695750043    8.03298020503780
C         0.19232372381034    9.47090118874900    8.30920396704305
H        -0.17495662414066   10.31098988345772    7.71637384700135
C        -0.67594115157851    9.31555757134196    9.55556768841168
H         1.21741625511152    9.70111884383710    8.60937495776836
H        -1.69991259626253    9.08266210689180    9.25490408737076
H        -0.30830994113016    8.47718475348049   10.15225715653869
C        -0.67693040658621   10.58085081331885   10.41003442092879
H        -1.04252266803052   11.41861108178719    9.81166665449892
C        -1.54720418287416   10.43426700690522   11.65574761504348
H         0.34732530885890   10.81386877858260   10.71115612191535
H        -2.57149902327273   10.20114196417365   11.35523965514407
H        -1.18138123351192    9.59774760898657   12.25621609586863
C        -1.54901948882146   11.70176810749271   12.50702978327156
H        -1.91895933235024   12.53700984652120   11.90791693596001
C        -2.41475523368176   11.54927535223169   13.75157358270470
H        -0.52446963124027   11.93734239456245   12.80439739164929
H        -3.44451725967585   11.33242249183945   13.47566759517789
H        -2.04915048355847   10.73460545048070   14.37314447706116
H        -2.40272157585445   12.46293848006879   14.34138945219304
C         0.62991783722310   -9.66462700507839    4.14239875227217
H         0.37737975755423   -9.52287695508281    5.19562076073965
C        -0.41237365084344  -10.56255857597371    3.47316219720065
H         1.00823692878524   -8.27125575526021    2.60576733933938
H        -4.89830410733488  -16.79588963469948    3.74500982684333
H        -3.98988735545109  -18.24067614147068    4.19241113188151
H        -1.88351077072908  -16.92523860777504    4.23259124082772
C        -3.92892430378695  -17.28501183670773    3.67690676445592
H        -3.06652764391661  -16.24916366934960    5.35124598357784
H        -3.71515023170424  -17.47421598306442    2.62706127194554
H        -0.16240299749602  -10.68843806521210    2.41615942024303
C        -0.48902630405602  -11.92935083161836    4.14725440451746
H        -1.38603414211048  -10.07174354097432    3.53234668759463
H         0.48304097068111  -12.42354655377163    4.07865484899907
H        -0.71669490329145  -11.79265428099232    5.20633696571863
C        -1.55633309234994  -12.81884558380278    3.51403139211759
H        -1.32488388687060  -12.96855505057770    2.45665826314559
C        -1.65409328365386  -14.17560590808763    4.20711383896645
H        -2.52391937316928  -12.31514894057998    3.57189479715938
H        -0.69042195117493  -14.68640180788073    4.14063894766138
H        -1.87319805323915  -14.02279434908204    5.26647241748224
C        -2.73720710141007  -15.05819139004231    3.59184633976933
H        -2.51613795152883  -15.21806932441847    2.53369065621322
C        -2.84483455011455  -16.40979136948237    4.29366581722120
H        -3.69920383410323  -14.54372655567229    3.65342284942201

}

pert = 0.001
lambdas = [pert, -pert, 2.0*pert, -2.0*pert]

set {
    basis     6-31g
    d_convergence   8
    reference rhf
    scf_type direct
}
method = 'B3LYP'

perturbed_energies = np.zeros((len(lambdas),3))
x_perturbed_dipoles = np.zeros((len(lambdas),3))
y_perturbed_dipoles = np.zeros((len(lambdas),3))
z_perturbed_dipoles = np.zeros((len(lambdas),3))

# start with a reference dipole calculation
properties(method, properties=['dipole'])
mu_x = psi4.core.variable(method + ' DIPOLE X') / psi_dipmom_au2debye
mu_y = psi4.core.variable(method + ' DIPOLE Y') / psi_dipmom_au2debye
mu_z = psi4.core.variable(method + ' DIPOLE Z') / psi_dipmom_au2debye
analytic_dipole = np.array([mu_x, mu_y, mu_z])

# now compute with different applied fields
for step, l in enumerate(lambdas):
    set perturb_h true
    set perturb_with dipole
    # x pertubation
    set perturb_dipole [$l, 0, 0]
    perturbed_energies[step,0] = properties(method, properties=['dipole'])
    x_perturbed_dipoles[step,0] = psi4.core.variable(method + ' DIPOLE X')
    x_perturbed_dipoles[step,1] = psi4.core.variable(method + ' DIPOLE Y')
    x_perturbed_dipoles[step,2] = psi4.core.variable(method + ' DIPOLE Z')
    # y pertubation
    set perturb_dipole [0, $l, 0]
    perturbed_energies[step,1] = properties(method, properties=['dipole'])
    y_perturbed_dipoles[step,0] = psi4.core.variable(method + ' DIPOLE X')
    y_perturbed_dipoles[step,1] = psi4.core.variable(method + ' DIPOLE Y')
    y_perturbed_dipoles[step,2] = psi4.core.variable(method + ' DIPOLE Z')
    # z pertubation
    set perturb_dipole [0, 0, $l]
    perturbed_energies[step,2] = properties(method, properties=['dipole'])
    z_perturbed_dipoles[step,0] = psi4.core.variable(method + ' DIPOLE X')
    z_perturbed_dipoles[step,1] = psi4.core.variable(method + ' DIPOLE Y')
    z_perturbed_dipoles[step,2] = psi4.core.variable(method + ' DIPOLE Z')

# use 3- and 5-point finite difference formulae to compute the dipole
mu_3pt = (perturbed_energies[0] - perturbed_energies[1]) / (2.0*pert)
mu_5pt = (8.0*perturbed_energies[0] - 8.0*perturbed_energies[1] - perturbed_energies[2] + perturbed_energies[3]) / (12.0*pert)
# and the polarizability
a_x_3pt = (x_perturbed_dipoles[0] - x_perturbed_dipoles[1]) / (2.0*pert)
a_y_3pt = (y_perturbed_dipoles[0] - y_perturbed_dipoles[1]) / (2.0*pert)
a_z_3pt = (z_perturbed_dipoles[0] - z_perturbed_dipoles[1]) / (2.0*pert)
alpha_3pt = np.vstack((a_x_3pt, a_y_3pt, a_z_3pt))
a_x_5pt = (8.0*x_perturbed_dipoles[0] - 8.0*x_perturbed_dipoles[1] - x_perturbed_dipoles[2] + x_perturbed_dipoles[3]) / (12.0*pert)
a_y_5pt = (8.0*y_perturbed_dipoles[0] - 8.0*y_perturbed_dipoles[1] - y_perturbed_dipoles[2] + y_perturbed_dipoles[3]) / (12.0*pert)
a_z_5pt = (8.0*z_perturbed_dipoles[0] - 8.0*z_perturbed_dipoles[1] - z_perturbed_dipoles[2] + z_perturbed_dipoles[3]) / (12.0*pert)
alpha_5pt = np.vstack((a_x_5pt, a_y_5pt, a_z_5pt))

# let's see what happened!
np.set_printoptions(suppress=True)
print('Analytic dipole\n', analytic_dipole)
print('3point finite difference dipole\n', mu_3pt)
print('5point finite difference dipole\n', mu_5pt)

print('3point finite difference polarizability\n', alpha_3pt)
print('5point finite difference polarizability\n', alpha_5pt)
